<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Respiraci√≥n Guiada: Zen Web</title>
  <style>
    /* --- 1. VARIABLES & RESET (BASE DEL DISE√ëO) --- */
    :root {
      --primary: #4CAF50;
      --primary-dark: #2e7d32;
      --accent: #1a5f7a;
      --bg-gradient: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
      --glass-bg: rgba(255, 255, 255, 0.85);
      --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
      --glass-border: 1px solid rgba(255, 255, 255, 0.4);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      background: var(--bg-gradient);
      color: #2c3e50;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between; /* Distribuye elementos arriba, centro y abajo */
      height: 100vh; /* Altura fija para evitar scroll */
      overflow: hidden;
      position: relative;
    }

    /* --- 2. CAPA UI SUPERIOR (CONTROLES) --- */
    .ui-top-bar {
      width: 100%;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      z-index: 50;
      pointer-events: none; /* Dejar pasar clicks a lo de abajo si fuera necesario */
    }

    /* Agrupamos controles para que no floten sueltos */
    .controls-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-end;
      pointer-events: auto;
    }

    .btn, .cycle-badge {
      background: var(--glass-bg);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: var(--glass-border);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      color: #455a64;
      box-shadow: 0 4px 6px rgba(0,0,0,0.02);
      transition: all 0.2s ease;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn:active, .btn.active {
      background: #e8f5e9;
      color: var(--primary-dark);
      border-color: var(--primary);
      transform: scale(0.96);
    }
    
    select {
        background: transparent;
        border: none;
        font-weight: bold;
        color: var(--primary-dark);
        outline: none;
    }

    /* --- 3. √ÅREA CENTRAL (ESFERA + TEXTO) --- */
    .center-stage {
      flex-grow: 1; /* Ocupa todo el espacio disponible */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      position: relative;
      z-index: 10;
    }

    .sphere {
      width: min(45vw, 220px); /* Responsive: nunca m√°s grande que 220px ni 45% del ancho */
      height: min(45vw, 220px);
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #a8ff60, #4CAF50);
      box-shadow: 0 20px 60px rgba(76, 175, 80, 0.35);
      will-change: transform;
      margin-bottom: 2rem;
    }

    .phase-text {
      font-size: clamp(1.5rem, 5vw, 2.5rem); /* Texto escala fluidamente */
      color: var(--accent);
      font-weight: 300;
      letter-spacing: 2px;
      text-transform: uppercase;
      opacity: 0.8;
      margin-bottom: 0.5rem;
      min-height: 3rem; /* Evita saltos */
      text-shadow: 0 2px 10px rgba(255,255,255,0.8);
    }

    .counter-text {
      font-size: clamp(2rem, 6vw, 3rem);
      font-weight: 800;
      color: var(--primary);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%); /* Centrado perfecto sobre la esfera */
      text-shadow: 0 2px 15px rgba(255,255,255,0.9);
      pointer-events: none;
    }

    /* --- 4. LA FRASE (NUEVO DISE√ëO EQUILIBRADO) --- */
    .quote-container {
      margin-top: 1rem;
      padding: 0 20px;
      text-align: center;
      max-width: 600px;
      height: 60px; /* Altura reservada para que no baile la pantalla */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .quote-text {
      font-family: 'Georgia', serif; /* Toque elegante */
      font-style: italic;
      color: #546e7a;
      font-size: clamp(1rem, 3vw, 1.25rem);
      line-height: 1.4;
      opacity: 0; /* Empieza invisible para efecto fade */
      transition: opacity 0.8s ease;
    }

    /* --- 5. √ÅREA INFERIOR (VISUALIZADOR + SELECTOR) --- */
    .bottom-ui {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-bottom: 20px;
      z-index: 20;
      background: linear-gradient(to top, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 100%);
    }

    .visualizer-container {
      width: 90%;
      max-width: 500px;
      height: 80px;
      margin-bottom: 15px;
    }
    
    #breathGraph {
      width: 100%;
      height: 100%;
      border-radius: 15px;
      /* background: rgba(255,255,255,0.4); Quitado para limpieza */ 
    }

    .pattern-label {
        color: var(--primary);
        font-weight: 800;
        letter-spacing: 1px;
        margin-bottom: 10px;
        font-size: 0.9rem;
        text-transform: uppercase;
        height: 20px;
    }

    /* --- 6. MODAL/SELECTOR DESLIZANTE --- */
    .pattern-selector-panel {
      width: 100%;
      max-width: 500px;
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border-top: var(--glass-border);
      border-radius: 25px 25px 0 0;
      padding: 20px;
      box-shadow: 0 -10px 40px rgba(0,0,0,0.05);
      transition: transform 0.3s ease;
    }

    .pattern-card {
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 16px;
      background: rgba(255,255,255,0.6);
      cursor: pointer;
      border: 1px solid transparent;
      transition: all 0.2s;
    }
    .pattern-card:hover { background: #fff; transform: translateY(-2px); }
    .pattern-card.active { border-color: var(--primary); background: #f1f8f1; }
    
    .pattern-name { color: var(--primary-dark); font-weight: 700; margin-bottom: 4px; }
    .pattern-desc { color: #78909c; font-size: 0.85rem; }

    /* --- 7. BOT√ìN FLOTANTE (FAB) PARA COMPARTIR --- */
    .fab-share {
        position: fixed;
        bottom: 25px;
        right: 25px;
        background: var(--accent);
        color: white;
        width: 55px;
        height: 55px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        box-shadow: 0 4px 15px rgba(26, 95, 122, 0.3);
        border: none;
        cursor: pointer;
        z-index: 100;
        transition: transform 0.2s;
    }
    .fab-share:hover { transform: scale(1.1); }
    .fab-text { display: none; } /* Solo icono en m√≥vil */

    /* PANTALLA DE BIENVENIDA (PILL OVERLAY) */
    #pillOverlay {
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(10px);
    }
    
    /* Responsive ajustes finos */
    @media (min-width: 768px) {
        .fab-share { 
            width: auto; height: auto; 
            padding: 12px 24px; 
            border-radius: 30px; 
            font-size: 1rem;
        }
        .fab-share span { display: inline; margin-left: 8px; } /* Texto visible en PC */
        .fab-text { display: inline; }
    }
  </style>
</head>
<body>

  <div id="pillOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:200; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:30px;">
    <div style="font-size:4rem; margin-bottom:10px;">üçÉ</div>
    <h1 style="color:var(--primary-dark); margin-bottom:10px; font-size: 2rem;">Una pausa para ti</h1>
    <h2 id="pillRecipient" style="color:#546e7a; margin-bottom:20px; font-weight:400; font-size:1.5rem;"></h2>
    <p id="pillMessage" style="font-size:1.3rem; font-style:italic; color:#37474f; margin-bottom:40px; max-width:600px; line-height: 1.6; padding:20px; background:rgba(255,255,255,0.5); border-radius:15px;"></p>
    <button id="startPillBtn" class="btn" style="background:var(--primary); color:white; border:none; padding:15px 40px; font-size:1.1rem;">Comenzar Ahora</button>
  </div>

  <div class="ui-top-bar">
    <div class="cycle-badge" id="cycleCounter">üîÑ 0</div>
    
    <div class="controls-group">
        <button class="btn" id="resetBtn">‚Üª Reiniciar</button>
        <div style="display:flex; gap:8px;">
            <div class="btn">
                ‚è±Ô∏è <select id="tempoSelect"><option value="1000">1x</option><option value="1500">0.7x</option><option value="2000">0.5x</option></select>
            </div>
            <button class="btn" id="soundBtn">üîá</button>
            <button class="btn" id="metronomeBtn">‚è±Ô∏è</button>
        </div>
    </div>
  </div>

  <div class="center-stage">
    <div class="sphere" id="sphere">
        <div class="counter" id="counterText"></div>
    </div>
    
    <div class="phase-text" id="phaseText">Respira</div>
    
    <div class="quote-container">
        <p class="quote-text" id="phraseContent">Cargando inspiraci√≥n...</p>
    </div>
  </div>

  <div class="bottom-ui">
    <div class="pattern-label" id="patternLabelDisplay"></div>
    
    <div class="visualizer-container">
        <canvas id="breathGraph"></canvas>
    </div>

    <div class="pattern-selector-panel" id="patternSelector">
        <h4 style="text-align:center; color:#cfd8dc; margin-bottom:15px; text-transform:uppercase; font-size:0.7rem; letter-spacing:2px;">Seleccionar Ejercicio</h4>
        
        <div class="pattern-card" data-pattern="4-4-6-2">
            <div class="pattern-name">4-4-6-2 ‚Ä¢ Relajaci√≥n Profunda</div>
            <div class="pattern-desc">Ideal para bajar pulsaciones r√°pidamente.</div>
        </div>
        <div class="pattern-card" data-pattern="4-7-8">
            <div class="pattern-name">4-7-8 ‚Ä¢ Para Dormir</div>
            <div class="pattern-desc">T√©cnica del Dr. Weil para el insomnio.</div>
        </div>
        <div class="pattern-card" data-pattern="box">
            <div class="pattern-name">Box Breathing ‚Ä¢ Enfoque</div>
            <div class="pattern-desc">Usada por Navy SEALs para concentraci√≥n.</div>
        </div>
        <div class="pattern-card" data-pattern="5-5">
            <div class="pattern-name">5-5 ‚Ä¢ Coherencia Card√≠aca</div>
            <div class="pattern-desc">Equilibrio perfecto del sistema nervioso.</div>
        </div>
    </div>
  </div>

  <button id="shareBtn" class="fab-share">
    üì§ <span class="fab-text">Enviar P√≠ldora</span>
  </button>

  <script>
    /* --- CONFIGURACI√ìN DE DATOS --- */
    const patterns = {
      '4-4-6-2': [
        { text: "Inhala", beats: 4, type: 'rise' }, { text: "Mant√©n", beats: 4, type: 'hold_high' },
        { text: "Exhala", beats: 6, type: 'fall' }, { text: "Sost√©n", beats: 2, type: 'hold_low' }
      ],
      '4-7-8': [
        { text: "Inhala", beats: 4, type: 'rise' }, { text: "Mant√©n", beats: 7, type: 'hold_high' },
        { text: "Exhala", beats: 8, type: 'fall' }
      ],
      'box': [
        { text: "Inhala", beats: 4, type: 'rise' }, { text: "Mant√©n", beats: 4, type: 'hold_high' },
        { text: "Exhala", beats: 4, type: 'fall' }, { text: "Sost√©n", beats: 4, type: 'hold_low' }
      ],
      '5-5': [
        { text: "Inhala", beats: 5, type: 'rise' }, { text: "Exhala", beats: 5, type: 'fall' }
      ]
    };

    const REFLECTIVE_PHRASES = [
      "El amor no es algo que haces, es lo que eres.",
      "Ama lo que es. La resistencia solo trae dolor.",
      "Cuando la mente se detiene, la belleza del mundo se revela.",
      "No eres tus pensamientos. Eres el silencio detr√°s de ellos.",
      "Acepta este momento radicalmente. Aqu√≠ reside la paz.",
      "Vuelve a casa, vuelve al ahora.",
      "Tu verdadera naturaleza es paz, amor y dicha.",
      "Observa sin juzgar. Eso es amor."
    ];

    /* --- VARIABLES --- */
    let currentPatternKey = null;
    let currentPatternData = [];
    let startTime = 0;
    let totalCycleDuration = 0;
    let tempo = 1000;
    let isRunning = false;
    let animationFrameId = null;
    let cycles = 0;
    let soundOn = false;
    let metronomeOn = false;
    let audioCtx = null;
    let lastPhraseIdx = -1;
    let lastBeatPlayed = -1;

    // DOM Elements
    const sphere = document.getElementById('sphere');
    const phaseText = document.getElementById('phaseText');
    const counterText = document.getElementById('counterText');
    const cycleCounter = document.getElementById('cycleCounter');
    const patternSelector = document.getElementById('patternSelector');
    const patternLabelDisplay = document.getElementById('patternLabelDisplay');
    const phraseEl = document.getElementById('phraseContent');
    const shareBtn = document.getElementById('shareBtn');
    
    // Canvas
    let canvas = document.getElementById('breathGraph');
    let ctx = canvas.getContext('2d');
    let segments = [];

    /* --- FUNCIONES L√ìGICAS --- */
    function setRandomPhrase() {
      let newIdx;
      do { newIdx = Math.floor(Math.random() * REFLECTIVE_PHRASES.length); } 
      while (newIdx === lastPhraseIdx && REFLECTIVE_PHRASES.length > 1);
      lastPhraseIdx = newIdx;
      
      phraseEl.style.opacity = 0;
      setTimeout(() => {
        phraseEl.textContent = REFLECTIVE_PHRASES[newIdx];
        phraseEl.style.opacity = 1;
      }, 500);
    }

    function initAudio() {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    
    function beep(freq = 440, type = 'sine', dur = 0.1) {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = type;
      osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
      gain.gain.setValueAtTime(0.05, audioCtx.currentTime); // Volumen m√°s bajo y suave
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + dur);
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start();
      osc.stop(audioCtx.currentTime + dur);
    }

    function recalculatePatternData() {
      if (!currentPatternKey) return;
      const patternDef = patterns[currentPatternKey];
      currentPatternData = [];
      let accumulatedTime = 0;
      
      patternDef.forEach(p => {
        const duration = p.beats * tempo;
        currentPatternData.push({
          ...p, startTime: accumulatedTime, endTime: accumulatedTime + duration, duration: duration
        });
        accumulatedTime += duration;
      });
      totalCycleDuration = accumulatedTime;
      calculateCanvasSegments();
    }

    function loop() {
      if (!isRunning) return;
      const now = Date.now();
      const elapsedTotal = now - startTime;
      const timeInCycle = elapsedTotal % totalCycleDuration;
      const currentCycle = Math.floor(elapsedTotal / totalCycleDuration);
      
      if (currentCycle > cycles) {
        cycles = currentCycle;
        cycleCounter.textContent = `üîÑ ${cycles}`;
      }

      const currentPhase = currentPatternData.find(p => timeInCycle >= p.startTime && timeInCycle < p.endTime);

      if (currentPhase) {
        if (phaseText.textContent !== currentPhase.text) {
             phaseText.textContent = currentPhase.text;
             if (soundOn) {
                let freq = 440;
                if(currentPhase.type === 'rise') freq = 300;
                if(currentPhase.type === 'hold_high') freq = 450;
                if(currentPhase.type === 'fall') freq = 400;
                if(currentPhase.type === 'hold_low') freq = 250;
                beep(freq, 'sine', 0.3);
             }
        }

        const timeInPhase = timeInCycle - currentPhase.startTime;
        const currentBeat = Math.floor(timeInPhase / tempo) + 1;
        counterText.textContent = currentBeat;

        const beatKey = `${cycles}-${currentPhase.text}-${currentBeat}`;
        if (metronomeOn && lastBeatPlayed !== beatKey) {
            beep(600, 'triangle', 0.05);
            lastBeatPlayed = beatKey;
        }

        const phaseProgress = timeInPhase / currentPhase.duration; 
        let scale = 1;
        if (currentPhase.type === 'rise') scale = 1 + (0.6 * phaseProgress); // Un poco m√°s de expansi√≥n
        else if (currentPhase.type === 'fall') scale = 1.6 - (0.6 * phaseProgress);
        else if (currentPhase.type === 'hold_high') scale = 1.6;
        else scale = 1;
        
        sphere.style.transform = `scale(${scale})`;
      }
      
      drawCanvas(timeInCycle);
      animationFrameId = requestAnimationFrame(loop);
    }

    function initCanvas() {
        // Ajuste de DPI para nitidez en pantallas retina
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.parentNode.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        calculateCanvasSegments();
    }

    function calculateCanvasSegments() {
      if (!currentPatternData.length) return;
      const width = canvas.width / (window.devicePixelRatio || 1);
      const height = canvas.height / (window.devicePixelRatio || 1);
      const margin = 10;
      
      segments = [];
      const totalBeats = currentPatternData.reduce((sum, p) => sum + p.beats, 0);
      const pxPerBeat = width / totalBeats;
      
      let currentX = 0;
      let currentY = height - margin; 

      currentPatternData.forEach(p => {
        const segWidth = p.beats * pxPerBeat;
        const endX = currentX + segWidth;
        let endY = currentY;
        
        if (p.type === 'rise') endY = margin;
        if (p.type === 'fall') endY = height - margin;
        if (p.type === 'hold_high') endY = margin;
        if (p.type === 'hold_low') endY = height - margin;
        
        segments.push({
            startX: currentX, endX: endX,
            startY: currentY, endY: endY,
            startTime: p.startTime, endTime: p.endTime
        });
        currentX = endX;
        currentY = endY;
      });
    }

    function drawCanvas(timeInCycle) {
      const w = canvas.width / (window.devicePixelRatio || 1);
      const h = canvas.height / (window.devicePixelRatio || 1);
      
      ctx.clearRect(0, 0, w, h);
      
      // Dibujar l√≠nea de fondo (trayectoria)
      ctx.beginPath();
      ctx.strokeStyle = 'rgba(76, 175, 80, 0.3)';
      ctx.lineWidth = 4;
      ctx.lineJoin = 'round';
      ctx.lineCap = 'round';
      segments.forEach((seg, i) => {
        if (i === 0) ctx.moveTo(seg.startX, seg.startY);
        ctx.lineTo(seg.endX, seg.endY);
      });
      ctx.stroke();

      // Dibujar bola de progreso
      const activeSeg = segments.find(s => timeInCycle >= s.startTime && timeInCycle < s.endTime);
      if (activeSeg) {
          const segDuration = activeSeg.endTime - activeSeg.startTime;
          const progress = (timeInCycle - activeSeg.startTime) / segDuration;
          const ballX = activeSeg.startX + (activeSeg.endX - activeSeg.startX) * progress;
          const ballY = activeSeg.startY + (activeSeg.endY - activeSeg.startY) * progress;
          
          ctx.beginPath();
          ctx.fillStyle = '#1a5f7a';
          ctx.shadowColor = "rgba(26, 95, 122, 0.5)";
          ctx.shadowBlur = 10;
          ctx.arc(ballX, ballY, 6, 0, Math.PI * 2);
          ctx.fill();
          ctx.shadowBlur = 0; // Reset shadow
      }
    }

    /* --- CONTROLES DE ESTADO --- */
    function start(patternKey) {
      if (isRunning) stop();
      currentPatternKey = patternKey;
      
      // Mostrar etiqueta del patr√≥n seleccionado
      const selectedEl = document.querySelector(`.pattern-card[data-pattern="${patternKey}"]`);
      if(selectedEl) {
          const name = selectedEl.querySelector('.pattern-name').innerText.split('‚Ä¢')[0].trim();
          patternLabelDisplay.textContent = name;
      }

      recalculatePatternData();
      
      // Animaci√≥n UI
      patternSelector.style.transform = "translateY(110%)"; // Ocultar hacia abajo
      shareBtn.style.transform = "scale(0)"; // Ocultar bot√≥n compartir

      cycleCounter.textContent = "üîÑ 0";
      initAudio();
      setRandomPhrase();
      
      setTimeout(() => {
        initCanvas();
        isRunning = true;
        startTime = Date.now();
        cycles = 0;
        lastBeatPlayed = -1;
        loop(); 
      }, 100);
    }

    function stop() {
      isRunning = false;
      cancelAnimationFrame(animationFrameId);
      
      sphere.style.transform = 'scale(1)';
      phaseText.textContent = "Respira";
      counterText.textContent = "";
      patternLabelDisplay.textContent = "";
      
      // Restaurar UI
      patternSelector.style.transform = "translateY(0)";
      shareBtn.style.transform = "scale(1)";
      shareBtn.style.display = "flex";

      if(ctx) {
         const w = canvas.width / (window.devicePixelRatio || 1);
         const h = canvas.height / (window.devicePixelRatio || 1);
         ctx.clearRect(0,0,w,h);
      }
      setRandomPhrase();
    }

    /* --- LISTENERS --- */
    document.querySelectorAll('.pattern-card').forEach(el => {
      el.addEventListener('click', () => {
        document.querySelectorAll('.pattern-card').forEach(o => o.classList.remove('active'));
        el.classList.add('active');
        start(el.dataset.pattern);
      });
    });

    document.getElementById('resetBtn').addEventListener('click', stop);
    
    document.getElementById('soundBtn').addEventListener('click', function() {
      soundOn = !soundOn;
      this.textContent = soundOn ? "üîä" : "üîá";
      initAudio();
    });

    document.getElementById('metronomeBtn').addEventListener('click', function() {
      metronomeOn = !metronomeOn;
      this.style.borderColor = metronomeOn ? "var(--primary)" : "transparent";
    });

    document.getElementById('tempoSelect').addEventListener('change', function() {
      tempo = parseInt(this.value);
      if (isRunning) { recalculatePatternData(); startTime = Date.now(); }
    });

    window.addEventListener('resize', () => { if (isRunning) initCanvas(); });

    // --- L√ìGICA DE URL Y COMPARTIR ---
    function getQueryParams() {
      const params = new URLSearchParams(window.location.search);
      return { p: params.get('p'), to: params.get('para'), msg: params.get('msg') };
    }

    window.addEventListener('DOMContentLoaded', () => {
      setRandomPhrase(); // Frase inicial
      const params = getQueryParams();

      if (params.p && patterns[params.p]) {
        // MODO P√çLDORA
        const overlay = document.getElementById('pillOverlay');
        document.getElementById('pillRecipient').textContent = `Hola, ${params.to || 'Alguien'}`;
        document.getElementById('pillMessage').textContent = params.msg ? `"${params.msg}"` : '"T√≥mate un respiro."';
        
        // Ocultar UI inicial
        patternSelector.style.transform = "translateY(110%)";
        shareBtn.style.display = 'none';
        
        overlay.style.display = 'flex';

        document.getElementById('startPillBtn').addEventListener('click', () => {
          overlay.style.display = 'none';
          if (params.msg) {
             phraseEl.textContent = params.msg;
             lastPhraseIdx = -999; 
          }
          start(params.p);
        });
      }
    });

    shareBtn.addEventListener('click', () => {
      const pattern = prompt("¬øQu√© ejercicio? (4-7-8, box, 5-5, 4-4-6-2)", "4-7-8");
      if (!patterns[pattern]) { alert("Patr√≥n no v√°lido."); return; }
      
      const name = prompt("¬øPara qui√©n?", "Amigo");
      const message = prompt("Mensaje:", "Rel√°jate un poco...");
      
      const baseUrl = window.location.href.split('?')[0];
      const finalUrl = `${baseUrl}?p=${pattern}&para=${encodeURIComponent(name||'Amigo')}&msg=${encodeURIComponent(message||'Respira')}`;
      const text = `Hola ${name}, te mando un respiro: ${finalUrl}`;
      
      navigator.clipboard.writeText(text).then(() => alert("¬°Enlace copiado! P√©galo en WhatsApp."));
    });

  </script>
</body>
</html>
